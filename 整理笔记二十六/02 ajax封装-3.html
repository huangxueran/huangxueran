<!doctype html><!--文档头信息-->
<html><!--根标签-->
<head><!--头部标签-->
    <meta charset="UTF-8"><!--字符编码-->
    <meta name="Generator" content="EditPlus®"><!--使用编辑器-->
    <meta name="Author" content="黄学然"><!--作者-->
    <meta name="Keywords" content="作业"><!--关键字-->
    <meta name="Description" content=""><!--描述-->
    <title>整理笔记（五）</title><!--网站标题-->
    <style>
        body{font-family: "Microsoft hYaHei",serif;}
        body,dl,dd,p,h1,h2,h3,h4,h5,h6,input{margin:0;}
        ol,ul,li{margin:0;padding:0;list-style:none;}
        img{border:none;}

    </style>

</head>
<body>

<script>
    /*
        ajaxd
     */
    ajax({
        url:'http://localhost:3000',
        data:{      //发送的数据
             name:'goudan',
             age:18
         },
        timeout:1000,
        /*type:'',    如果要添加数据直接在这里在这里就行了*/
        success:function (msg) {
            console.log(msg)
        },
        error:function (msg) {
            console.error(msg)
        }
    });
    function ajax(obj) {
        //不传method默认使用get请求
        var method =obj.method || 'get',
            url=obj.url,
            //不传async就默认异步
            //true
            //underfine
            //false
            async=obj.async || false;
             data=obj.data,
                 timeout=(typeof obj.timeout === 'number')?
                 obj.timeout:false;
            success=obj.success;
            error=obj.error;

        var str="";
        //没有data 则不遍历
        if(data){
            //处理data数据
            //name=fy&age=18
            //name=fy&age=18&  备注:可以在后面添加&,但不可以在后面添加&

            for(var key in data) { //statement
                str += key + "=" + data[key] + '&'

            }
        }

        /*
            	解决get方式的缓存问题
				post没有缓存问题
         */
        if(method.indexOf('get') > -1){// get方式
            url += '?' + str + 't_=' + Date.now();
        }

        var xhr = new XMLHttpRequest();

        xhr.open(method, url, async);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

        if(timeout !== false){
            setTimeout(function(){
                xhr.abort();
            }, timeout)
        };
        xhr.send(str||null);
        xhr.onreadystatechange = function(){
            if(xhr.readyState !== 4)return;
            if(xhr.status >= 200 && xhr.status < 300 || xhr.status === 304){
                success && success(xhr.responseText)
            }else{
                error && error(xhr.status)
            }
        }
    }
</script>
</body>
</html>